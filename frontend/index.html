<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω S·∫£n Ph·∫©m (InfinityFree)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container mt-5" style="max-width: 800px;">
        <h2 class="text-center text-primary mb-3">üöÄ H·ªá Th·ªëng Qu·∫£n L√Ω S·∫£n Ph·∫©m</h2>

        <div class="card p-4 mb-4 shadow-sm">
            <input type="hidden" id="pId">
            <div class="row g-2">
                <div class="col-md-4">
                    <label class="small text-muted">T√™n s·∫£n ph·∫©m</label>
                    <input id="pName" class="form-control" placeholder="VD: iPhone 15">
                </div>
                <div class="col-md-3">
                    <label class="small text-muted">Gi√° b√°n</label>
                    <input id="pPrice" type="number" class="form-control" placeholder="0">
                </div>
                <div class="col-md-3">
                    <label class="small text-muted">M√¥ t·∫£</label>
                    <input id="pDesc" class="form-control" placeholder="M√†u s·∫Øc...">
                </div>
                <div class="col-md-2 d-flex align-items-end gap-1">
                    <button onclick="save()" id="btnSave" class="btn btn-success w-100 fw-bold">
                        <i class="fas fa-plus"></i> Th√™m v√†o danh s√°ch
                    </button>
                    <button onclick="resetForm()" id="btnCancel" class="btn btn-secondary" style="display:none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-body p-0">
                <table class="table table-hover table-striped mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>T√™n</th>
                            <th>Gi√°</th>
                            <th>M√¥ t·∫£</th>
                            <th class="text-center">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="list">
                    </tbody>
                </table>
                <div id="loading" class="text-center p-3 text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</div>
            </div>
        </div>
    </div>

    <script>
        // --- QUAN TR·ªåNG: ƒê∆∞·ªùng d·∫´n API t∆∞∆°ng ƒë·ªëi ---
        // Khi ch·∫°y tr√™n InfinityFree, n√≥ s·∫Ω t·ª± hi·ªÉu l√† t√¨m file api.php c√πng th∆∞ m·ª•c
        const API = 'api.php';

        let products = [];

        // 1. T·∫£i danh s√°ch
        async function load() {
            try {
                const res = await fetch(API);
                const text = await res.text();

                try {
                    products = JSON.parse(text); // √âp ki·ªÉu JSON
                    render(products);
                    document.getElementById('loading').style.display = 'none';
                } catch (e) {
                    console.error("L·ªói d·ªØ li·ªáu:", text);
                    document.getElementById('loading').innerHTML = '<span class="text-danger">L·ªói k·∫øt n·ªëi Server!</span>';
                }
            } catch (e) { console.error("L·ªói m·∫°ng:", e); }
        }

        // 2. Hi·ªÉn th·ªã l√™n b·∫£ng
        function render(data) {
            if (data.length === 0) {
                document.getElementById('list').innerHTML = '<tr><td colspan="5" class="text-center p-3">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</td></tr>';
                return;
            }
            document.getElementById('list').innerHTML = data.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td class="fw-bold text-primary">${p.name}</td>
                    <td class="text-danger fw-bold">${parseInt(p.price).toLocaleString()} ƒë</td>
                    <td class="text-muted small">${p.description}</td>
                    <td class="text-center">
                        <button onclick="edit(${p.id})" class="btn btn-sm btn-warning text-white"><i class="fas fa-edit"></i></button>
                        <button onclick="del(${p.id})" class="btn btn-sm btn-danger ms-1"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`).join('');
        }

        // 3. L∆∞u (Th√™m m·ªõi ho·∫∑c C·∫≠p nh·∫≠t)
        async function save() {
            const id = document.getElementById('pId').value;
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;

            if (!name || !price) return alert("Vui l√≤ng nh·∫≠p t√™n v√† gi√°!");

            const payload = {
                id: id,
                name: name,
                price: price,
                description: document.getElementById('pDesc').value
            };

            const method = id ? 'PUT' : 'POST';

            document.getElementById('btnSave').innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang l∆∞u...';

            await fetch(API, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            resetForm();
            load();
        }

        // 4. Ch·∫ø ƒë·ªô S·ª≠a
        function edit(id) {
            const p = products.find(x => x.id == id);
            if (p) {
                document.getElementById('pId').value = p.id;
                document.getElementById('pName').value = p.name;
                document.getElementById('pPrice').value = p.price;
                document.getElementById('pDesc').value = p.description;

                const btn = document.getElementById('btnSave');
                btn.className = 'btn btn-warning w-100 text-white fw-bold';
                btn.innerHTML = '<i class="fas fa-save"></i> L∆∞u l·∫°i';
                document.getElementById('btnCancel').style.display = 'block';
            }
        }

        // 5. Reset Form
        function resetForm() {
            document.getElementById('pId').value = '';
            document.getElementById('pName').value = '';
            document.getElementById('pPrice').value = '';
            document.getElementById('pDesc').value = '';

            const btn = document.getElementById('btnSave');
            btn.className = 'btn btn-success w-100 fw-bold';
            btn.innerHTML = '<i class="fas fa-plus"></i> Th√™m';
            document.getElementById('btnCancel').style.display = 'none';
        }

        // 6. X√≥a
        async function del(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√¥ng?')) {
                await fetch(`${API}?id=${id}`, { method: 'DELETE' });
                load();
            }
        }

        // Ch·∫°y khi m·ªü trang
        load();
    </script>
</body>

</html>